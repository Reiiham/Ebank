import{Ab as N,B as _,Cb as P,E as T,Ea as h,Fa as x,Jb as H,Kb as U,Nb as B,Ob as F,Pa as i,Qa as u,Qb as R,Tb as j,Ua as m,Va as C,Wa as b,Wb as $,_a as I,ab as w,ac as W,ba as c,bc as Q,cb as D,cc as q,fa as v,ha as E,ic as z,j as O,la as y,oa as g,p as d,pb as k,qb as M,va as r,vb as A,wa as o,wb as L,z as p}from"./chunk-OMX5D2LD.js";var f=class s{constructor(e){this.http=e}baseUrl=`${F.apiUrl}/employee`;getAuthHeaders(){let e=new N({"Content-Type":"application/json"});if(typeof window<"u"&&window.localStorage){let t=localStorage.getItem("token")||localStorage.getItem("authToken")||localStorage.getItem("jwt");console.log("\u{1F511} Token found:",t?"YES":"NO"),console.log("\u{1F511} Token value:",t?.substring(0,20)+"..."),t?e=e.set("Authorization",`Bearer ${t}`):console.warn("\u26A0\uFE0F No auth token found in localStorage!")}else console.warn("\u{1F6AB} localStorage not available (probably prerendering)");return e}handleError=(e="operation")=>t=>(console.error(`\u274C ${e} failed:`,t),console.error("Status:",t.status),console.error("Status Text:",t.statusText),console.error("Error Body:",t.error),console.error("Full URL:",t.url),t.status===401&&console.error("\u{1F6A8} UNAUTHORIZED - Check your token!"),O(()=>t));addAccount(e){return this.http.post(`${this.baseUrl}/clients/add-account`,e,{headers:this.getAuthHeaders(),responseType:"json"})}getAccountCount(){return this.http.get(`${this.baseUrl}/accounts/count`,{headers:this.getAuthHeaders()}).pipe(p(e=>console.log("\u2705 Account count result:",e)),d(this.handleError("getAccountCount")))}getClientCount(){return this.http.get(`${this.baseUrl}/clients/count`,{headers:this.getAuthHeaders()}).pipe(p(e=>console.log("\u2705 Client count result:",e)),d(this.handleError("getClientCount")))}getBasicClients(){return this.http.get(`${this.baseUrl}/clients/basic`,{headers:this.getAuthHeaders()}).pipe(p(e=>console.log("\u2705 Basic clients result:",e?.length,"items")),d(this.handleError("getBasicClients")))}getAllClients(){return this.http.get(`${this.baseUrl}/clients/detailed`,{headers:this.getAuthHeaders()}).pipe(p(e=>{console.log("\u2705 All clients result:",e?.length,"items"),console.log("First client sample:",e?.[0])}),d(this.handleError("getAllClients")))}getClientById(e){return this.http.get(`${this.baseUrl}/clients/${e}`,{headers:this.getAuthHeaders()}).pipe(p(t=>console.log("\u2705 Client by ID result:",t)),d(this.handleError("getClientById")))}searchClientsByName(e){return this.http.get(`${this.baseUrl}/clients/search?name=${encodeURIComponent(e)}`,{headers:this.getAuthHeaders()}).pipe(p(t=>console.log("\u2705 Search clients result:",t?.length,"items")),d(this.handleError("searchClientsByName")))}createClient(e){return this.http.post(`${this.baseUrl}/enroll`,e,{headers:this.getAuthHeaders()}).pipe(p(t=>console.log("\u2705 Create client result:",t)),d(this.handleError("createClient")))}updateClient(e){return this.http.put(`${this.baseUrl}/update`,e,{headers:this.getAuthHeaders(),responseType:"text"}).pipe(p(t=>console.log("\u2705 Update client result:",t)),d(this.handleError("updateClient")))}deleteClient(e){return this.http.request("delete",`${this.baseUrl}/delete`,{body:e,headers:this.getAuthHeaders()}).pipe(p(t=>console.log("\u2705 Delete client result:",t)),d(this.handleError("deleteClient")))}toggleClientStatus(e,t,n){return this.http.put(`${this.baseUrl}/clients/${e}/status`,null,{headers:this.getAuthHeaders(),params:{compteBloque:t.toString(),documentsComplets:n.toString()},responseType:"text"})}static \u0275fac=function(t){return new(t||s)(T(P))};static \u0275prov=_({token:s,factory:s.\u0275fac,providedIn:"root"})};var X=s=>["/employee/clients",s];function Y(s,e){if(s&1&&(r(0,"div",15),i(1),o()),s&2){let t=x();c(),u(t.error)}}function Z(s,e){if(s&1&&(r(0,"tr")(1,"td"),i(2),o(),r(3,"td"),i(4),o(),r(5,"td"),i(6),w(7,"currency"),o(),r(8,"td")(9,"a",16)(10,"button",17),i(11,"Voir D\xE9tails"),o()()()()),s&2){let t=e.$implicit,n=x();c(2),u(t.fullName),c(2),u(t.accounts.length||0),c(2),u(D(7,4,n.getTotalBalance(t),"MAD")),c(3),g("routerLink",I(7,X,t.clientId))}}var V=class s{constructor(e,t){this.clientService=e;this.router=t}clients=[];searchQuery="";error="";sortField="name";sortDirection="asc";ngOnInit(){console.log("\u{1F50D} ClientListComponent initialized"),this.checkAuthOnInit(),this.loadClients()}checkAuthOnInit(){if(typeof window<"u"&&window.localStorage){let e=localStorage.getItem("token")||localStorage.getItem("authToken")||localStorage.getItem("jwt");if(console.log("\u{1F511} Token check in ClientList:",e?"EXISTS":"MISSING"),!e){console.error("\u274C No token found in ClientList component"),this.router.navigate(["/login"]);return}try{if(e.includes(".")){let t=JSON.parse(atob(e.split(".")[1]));if(t.exp&&t.exp<Date.now()/1e3){console.error("\u{1F6A8} Token is expired in ClientList"),localStorage.removeItem("token"),localStorage.removeItem("authToken"),localStorage.removeItem("jwt"),this.router.navigate(["/login"]);return}console.log("\u2705 JWT token is valid, expires at:",new Date(t.exp*1e3))}}catch{console.log("\u{1F50D} Token is not JWT format, proceeding...")}}else console.warn("\u{1F6AB} localStorage not available (probably prerendering)")}loadClients(){console.log("\u{1F4E5} Loading clients..."),this.clientService.getAllClients().subscribe({next:e=>{console.log("\u2705 Clients loaded successfully:",e.length,"clients"),this.clients=e,this.sortClients(),this.error=""},error:e=>{console.error("\u274C Error loading clients:",e),e.status===401?(console.error("\u{1F6A8} 401 Unauthorized - redirecting to login"),localStorage.clear(),this.router.navigate(["/login"])):this.error="Erreur lors du chargement des clients."}})}search(){console.log("\u{1F50D} Searching for:",this.searchQuery),this.searchQuery.trim()?this.clientService.searchClientsByName(this.searchQuery).subscribe({next:e=>{console.log("\u2705 Search results:",e.length,"clients found"),this.clients=e,this.sortClients(),this.error=""},error:e=>{console.error("\u274C Error searching clients:",e),e.status===401?(console.error("\u{1F6A8} 401 Unauthorized in search - redirecting to login"),localStorage.clear(),this.router.navigate(["/login"])):this.error="Erreur lors de la recherche."}}):this.loadClients()}navigateToDetails(e){console.log("\u{1F50D} Navigating to client details:",e);let t=typeof window<"u"?localStorage.getItem("token"):null;if(console.log("\u{1F511} Token before navigation:",t?"EXISTS":"MISSING"),!t){console.error("\u274C No token found during navigation!"),this.router.navigate(["/login"]);return}if(!e.clientId){console.error("\u274C Client ID is missing:",e),this.error="ID client manquant";return}console.log("\u2705 Navigating to /clients/"+e.clientId),this.router.navigate(["/clients",e.clientId])}sortClients(){this.clients.sort((e,t)=>{let n,a;switch(this.sortField){case"name":n=e.fullName.toLowerCase(),a=t.fullName.toLowerCase();break;case"accounts":n=e.accounts?.length||0,a=t.accounts?.length||0;break;case"balance":n=e.accounts?.reduce((l,S)=>l+S.balance,0)||0,a=t.accounts?.reduce((l,S)=>l+S.balance,0)||0;break;default:return 0}return this.sortDirection==="asc"?n-a:a-n})}getTotalBalance(e){return e.accounts?.reduce((t,n)=>t+n.balance,0)||0}toggleSort(e){this.sortField===e?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortField=e,this.sortDirection="asc"),this.sortClients()}refresh(){console.log("\u{1F504} Manual refresh triggered"),this.loadClients()}static \u0275fac=function(t){return new(t||s)(v(f),v(H))};static \u0275cmp=E({type:s,selectors:[["app-client-list"]],decls:38,vars:5,consts:[[1,"client-list-container"],[1,"top-bar"],[1,"search-bar"],["placeholder","\u{1F50D} Rechercher un client...",3,"ngModelChange","ngModel"],[3,"click"],[1,"sort-bar"],[3,"ngModelChange","change","ngModel"],["value","name"],["value","accounts"],["value","balance"],["value","asc"],["value","desc"],["class","error-msg",4,"ngIf"],[1,"client-table-wrapper"],[4,"ngFor","ngForOf"],[1,"error-msg"],[3,"routerLink"],[1,"btn-details"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"h2"),i(2,"\u{1F4CB} Liste des Clients"),o(),r(3,"div",1)(4,"div",2)(5,"input",3),b("ngModelChange",function(l){return C(n.searchQuery,l)||(n.searchQuery=l),l}),o(),r(6,"button",4),h("click",function(){return n.search()}),i(7,"Rechercher"),o()(),r(8,"div",5)(9,"label"),i(10,"Trier par :"),o(),r(11,"select",6),b("ngModelChange",function(l){return C(n.sortField,l)||(n.sortField=l),l}),h("change",function(){return n.sortClients()}),r(12,"option",7),i(13,"Nom"),o(),r(14,"option",8),i(15,"Comptes"),o(),r(16,"option",9),i(17,"Solde"),o()(),r(18,"select",6),b("ngModelChange",function(l){return C(n.sortDirection,l)||(n.sortDirection=l),l}),h("change",function(){return n.sortClients()}),r(19,"option",10),i(20,"Croissant"),o(),r(21,"option",11),i(22,"D\xE9croissant"),o()()()(),y(23,Y,2,1,"div",12),r(24,"div",13)(25,"table")(26,"thead")(27,"tr")(28,"th"),i(29,"Nom Complet"),o(),r(30,"th"),i(31,"Comptes"),o(),r(32,"th"),i(33,"Solde Total"),o(),r(34,"th"),i(35,"Actions"),o()()(),r(36,"tbody"),y(37,Z,12,9,"tr",14),o()()()()),t&2&&(c(5),m("ngModel",n.searchQuery),c(6),m("ngModel",n.sortField),c(7),m("ngModel",n.sortDirection),c(5),g("ngIf",n.error),c(14),g("ngForOf",n.clients))},dependencies:[L,k,M,A,z,Q,q,R,W,j,$,B,U],styles:[".client-list-container[_ngcontent-%COMP%]{background-color:#f8fafc;padding:30px;border-radius:12px}h2[_ngcontent-%COMP%]{color:#1e3a8a;font-size:28px;margin-bottom:30px}.top-bar[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:space-between;gap:16px;margin-bottom:20px}.search-bar[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:8px 12px;border:1px solid #cbd5e1;border-radius:6px;min-width:250px}.search-bar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#2563eb;color:#fff;padding:8px 14px;margin-left:8px;border:none;border-radius:6px;cursor:pointer}.sort-bar[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:8px;border-radius:6px;border:1px solid #cbd5e1;margin-left:10px}.client-table-wrapper[_ngcontent-%COMP%]{overflow-x:auto}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;background-color:#fff;border-radius:12px;overflow:hidden;box-shadow:0 4px 12px #0000000d}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:16px;text-align:left}th[_ngcontent-%COMP%]{background-color:#e5e7eb;color:#1e3a8a;font-weight:600}tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f1f5f9}.btn-details[_ngcontent-%COMP%]{background-color:#3b82f6;color:#fff;padding:6px 12px;border:none;border-radius:8px;cursor:pointer;transition:background-color .3s}.btn-details[_ngcontent-%COMP%]:hover{background-color:#2563eb}.error-msg[_ngcontent-%COMP%]{background-color:#fee2e2;color:#dc2626;padding:12px;border-radius:6px;margin-bottom:20px}"]})};export{f as a,V as b};
